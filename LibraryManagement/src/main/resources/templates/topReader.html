<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>ƒê·ªôc gi·∫£ ƒë·ªçc nhi·ªÅu nh·∫•t</title>
	<link rel="stylesheet" th:href="@{/css/topReader.css}">
	<link rel="stylesheet" th:href="@{/css/admin.css}">
</head>
<body>

<!-- Sidebar -->
<div th:replace="admin :: sidebar"></div>

		<!-- Danh s√°ch ƒë·ªôc gi·∫£ -->
	<div class="reader-container">
		<h2>Top ƒë·ªôc gi·∫£ ƒë·ªçc nhi·ªÅu nh·∫•t</h2>
		<!-- Toolbar -->
		<div class="toolbar">
		    <form th:action="@{/admin/statistics/top-readers}" method="post" 
		            onsubmit="return validateForm()" id="statsForm">
		        
		        <!-- Nh√≥m √¥ t√¨m ki·∫øm -->
		        <div class="input-group">
		            <label for="searchQuery">T√¨m ki·∫øm:</label>
		            <input type="text" id="searchQuery" name="query" 
		                placeholder="Nh·∫≠p th√¥ng tin s√°ch..." th:value="${param.query}">
		        </div>
		
		        <!-- Nh√≥m √¥ Th√°ng - NƒÉm (T·ª´ v√† ƒê·∫øn) -->
		        <div class="month-year-group">
		            <div class="month-year">
		                <label for="fromMonth">T·ª´ Th√°ng:</label>
		                <input type="number" id="fromMonth" name="fromMonth" placeholder="Nh·∫≠p th√°ng (1-12)" th:value="${param.fromMonth}">
		            </div>
		            <div class="month-year">
		                <label for="fromYear">T·ª´ NƒÉm:</label>
		                <input type="number" id="fromYear" name="fromYear" placeholder="Nh·∫≠p nƒÉm (VD: 2023)" th:value="${param.fromYear}">
		            </div>
		            <div class="month-year">
		                <label for="toMonth">ƒê·∫øn Th√°ng:</label>
		                <input type="number" id="toMonth" name="toMonth" placeholder="Nh·∫≠p th√°ng (1-12)" th:value="${param.toMonth}">
		            </div>
		            <div class="month-year">
		                <label for="toYear">ƒê·∫øn NƒÉm:</label>
		                <input type="number" id="toYear" name="toYear" placeholder="Nh·∫≠p nƒÉm (VD: 2023)" th:value="${param.toYear}">
		            </div>
		        </div>
		
		        <!-- V√πng Button -->
		        <div class="button-group">
		            <button type="submit">T√¨m ki·∫øm</button>
		            <button type="button" class="reset-btn" onclick="resetForm()">L√†m m·ªõi</button>
		        </div>
		
		        <!-- Th√¥ng b√°o l·ªói -->
		        <span id="errorMsg" class="error-msg"></span>
		    </form>
		</div>

          <table class="table">
            <thead>
				<tr>
					<th>STT</th>
					<th>ID</th>
					<th>T√™n</th>
					<th>S·ªë ƒëi·ªán tho·∫°i</th>
					<th>Email</th>
					<th>S·ªë l∆∞·ª£t m∆∞·ª£n</th>
				</tr>
				</thead>
			<tbody>
			<tr th:each="reader, iterStat : ${topReader}" class="reader-item" >
	                <td class="medal" th:text="${iterStat.index + 1}">ü•á</td>
	                <td th:text="${reader.userId}"></td>
	                <td th:text="${reader.name}"></td>
	                <td th:text="${reader.phone}"></td>
	                <td th:text="${reader.email}"></td>
	                <td th:text="${reader.borrowCount}"></td>
           	</tr>
			<tr th:each="reader, iterStat : ${reader}">
				<td th:text="${iterStat.index + 4}"></td>
				<td th:text="${reader.userId}"></td>
				<td th:text="${reader.name}"></td>
				<td th:text="${reader.phone}"></td>
				<td th:text="${reader.email}"></td>
				<td th:text="${reader.borrowCount}"></td>
			</tr>
			 <!-- Th√¥ng b√°o kh√¥ng c√≥ d·ªØ li·ªáu -->
                <tr th:if="${#lists.isEmpty(reader)}">
                    <td colspan="9" class="no-data">Kh√¥ng c√≥ d·ªØ li·ªáu</td>
                </tr>
			</tbody>

		</table>
	</div>
</body>

<script>
function validateForm() {
    const fromMonth = document.getElementById('fromMonth').value.trim();
    const fromYear = document.getElementById('fromYear').value.trim();
    const toMonth = document.getElementById('toMonth').value.trim();
    const toYear = document.getElementById('toYear').value.trim();
    const errorMsg = document.getElementById('errorMsg');

    if ((fromMonth && !fromYear) || (toMonth && !toYear)) {
        errorMsg.textContent = "Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß Th√°ng v√† NƒÉm cho kho·∫£ng th·ªùi gian!";
        errorMsg.style.display = "block";
        return false;
    }

    if (fromYear && toYear && (parseInt(fromYear) > parseInt(toYear) || (parseInt(fromYear) === parseInt(toYear) && parseInt(fromMonth) > parseInt(toMonth)))) {
        errorMsg.textContent = "Kho·∫£ng th·ªùi gian kh√¥ng h·ª£p l·ªá! Ng√†y b·∫Øt ƒë·∫ßu ph·∫£i nh·ªè h∆°n ho·∫∑c b·∫±ng ng√†y k·∫øt th√∫c.";
        errorMsg.style.display = "block";
        return false;
    }

    errorMsg.style.display = "none";
    return true;
}

function resetForm() {
    const form = document.getElementById('statsForm');
    form.reset();
    document.getElementById('searchQuery').value = '';
    document.getElementById('fromMonth').value = '';
    document.getElementById('fromYear').value = '';
    document.getElementById('toMonth').value = '';
    document.getElementById('toYear').value = '';
    form.submit();
}

window.onload = function () {
    const urlParams = new URLSearchParams(window.location.search);
    const query = urlParams.get('query');
    const fromMonth = urlParams.get('fromMonth');
    const fromYear = urlParams.get('fromYear');
    const toMonth = urlParams.get('toMonth');
    const toYear = urlParams.get('toYear');

    if (query) document.getElementById('searchQuery').value = query;
    if (fromMonth) document.getElementById('fromMonth').value = fromMonth;
    if (fromYear) document.getElementById('fromYear').value = fromYear;
    if (toMonth) document.getElementById('toMonth').value = toMonth;
    if (toYear) document.getElementById('toYear').value = toYear;
};
</script>

</html>